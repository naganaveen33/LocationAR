<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Location AR with GLB Models</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    <style>
      body {
        margin: 0;
        overflow: hidden;
        font-family: Arial, sans-serif;
      }
      .info-panel {
        position: fixed;
        top: 10px;
        left: 10px;
        background: rgba(0, 0, 0, 0.85);
        color: white;
        padding: 15px;
        border-radius: 10px;
        z-index: 1000;
        max-width: 320px;
        font-size: 13px;
      }
      .model-info {
        margin-top: 10px;
        padding-top: 10px;
        border-top: 1px solid rgba(255,255,255,0.3);
        font-size: 11px;
        opacity: 0.8;
      }
      #loading {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.95);
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        color: white;
        z-index: 9999;
      }
      #loading.hidden {
        display: none;
      }
      .spinner {
        border: 4px solid rgba(255, 255, 255, 0.3);
        border-top: 4px solid #4CAF50;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
        margin-bottom: 20px;
      }
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      .controls {
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 1000;
      }
      .btn {
        background: rgba(0, 0, 0, 0.8);
        color: white;
        border: 2px solid #4CAF50;
        padding: 12px 24px;
        border-radius: 25px;
        font-size: 14px;
        font-weight: bold;
        cursor: pointer;
      }
      .status {
        position: fixed;
        bottom: 80px;
        left: 50%;
        transform: translateX(-50%);
        background: rgba(76, 175, 80, 0.9);
        color: white;
        padding: 10px 20px;
        border-radius: 20px;
        z-index: 1000;
        display: none;
      }
    </style>
  </head>
  <body>
    <!-- Loading Screen -->
    <div id="loading">
      <div class="spinner"></div>
      <div style="font-size: 24px; margin-bottom: 10px;">ðŸŽ¯ Loading 3D Models</div>
      <div style="font-size: 14px; opacity: 0.8;" id="loading-text">Initializing GPS...</div>
    </div>

    <!-- AR Scene -->
    <a-scene
      vr-mode-ui="enabled: false"
      arjs="sourceType: webcam; videoTexture: true; debugUIEnabled: false;"
      renderer="logarithmicDepthBuffer: true; colorManagement: true; sortObjects: true;"
      embedded
      id="scene">
      
      <!-- Assets - Load your GLB models here -->
      <a-assets>
        <!-- Replace these with your actual GLB file paths -->
        <a-asset-item id="model1" src="./lion_3d.glb"></a-asset-item>
        <a-asset-item id="model2" src="./lion_3d.glb"></a-asset-item>
        <a-asset-item id="model3" src="./lion_3d.glb"></a-asset-item>
        
        <!-- You can also load from URLs -->
        <!-- <a-asset-item id="model4" src="https://example.com/model.glb"></a-asset-item> -->
      </a-assets>
      
      <a-camera gps-projected-camera rotation-reader look-controls-enabled="false"></a-camera>

      <!-- ========================================= -->
      <!-- EXAMPLE 1: Basic GLB Model -->
      <!-- ========================================= -->
      <a-entity
        gps-projected-entity-place="latitude: 9.4981; longitude: 76.3388;"
        gltf-model="#model1"
        scale="100 100 100"
        rotation="0 0 0"
        position="0 0 0">
      </a-entity>

      <!-- ========================================= -->
      <!-- EXAMPLE 2: GLB Model with Animation -->
      <!-- ========================================= -->
      <a-entity
        gps-projected-entity-place="latitude: 9.4985; longitude: 76.3390;"
        gltf-model="#model2"
        scale="15 15 15"
        rotation="0 0 0"
        animation="property: rotation; to: 0 360 0; loop: true; dur: 10000; easing: linear">
      </a-entity>

      <!-- ========================================= -->
      <!-- EXAMPLE 3: GLB Model with Label -->
      <!-- ========================================= -->
      <a-entity gps-projected-entity-place="latitude: 9.4978; longitude: 76.3385;">
        <!-- The 3D Model -->
        <a-entity
          gltf-model="#model3"
          scale="8 8 8"
          rotation="0 180 0"
          position="0 0 0">
        </a-entity>
        
        <!-- Label above the model -->
        <a-text
          value="Ancient Tree"
          align="center"
          color="#FFFFFF"
          scale="10 10 10"
          position="0 15 0"
          look-at="[camera]">
        </a-text>
        
        <!-- Distance label -->
        <a-text
          id="distance-label-1"
          value="Calculating..."
          align="center"
          color="#4CAF50"
          scale="8 8 8"
          position="0 12 0"
          look-at="[camera]">
        </a-text>
      </a-entity>

      <!-- ========================================= -->
      <!-- EXAMPLE 4: Multiple Models in One Location -->
      <!-- ========================================= -->
      <a-entity gps-projected-entity-place="latitude: 9.4983; longitude: 76.3387;">
        <!-- Model 1 at center -->
        <a-entity
          gltf-model="#model1"
          scale="5 5 5"
          position="0 0 0">
        </a-entity>
        
        <!-- Model 2 offset to the right -->
        <a-entity
          gltf-model="#model2"
          scale="5 5 5"
          position="10 0 0">
        </a-entity>
        
        <!-- Model 3 offset to the left -->
        <a-entity
          gltf-model="#model3"
          scale="5 5 5"
          position="-10 0 0">
        </a-entity>
      </a-entity>

      <!-- ========================================= -->
      <!-- EXAMPLE 5: Interactive Clickable Model -->
      <!-- ========================================= -->
      <a-entity
        gps-projected-entity-place="latitude: 9.4979; longitude: 76.3392;"
        gltf-model="#model1"
        scale="12 12 12"
        class="clickable"
        click-handler
        animation__click="property: scale; to: 15 15 15; dur: 300; startEvents: click"
        animation__clickend="property: scale; to: 12 12 12; dur: 300; startEvents: animationcomplete__click">
      </a-entity>

      <!-- ========================================= -->
      <!-- EXAMPLE 6: Model with Lighting -->
      <!-- ========================================= -->
      <a-entity gps-projected-entity-place="latitude: 12.980597; longitude: 77.596222;">
        <!-- Ambient light for the model -->
        <a-light type="ambient" intensity="0.5"></a-light>
        
        <!-- Directional light -->
        <a-light type="directional" intensity="0.8" position="1 1 1"></a-light>
        
        <!-- The model -->
        <a-entity
          gltf-model="#model2"
          scale="10 10 10"
          rotation="0 90 0">
        </a-entity>
      </a-entity>

      <!-- ========================================= -->
      <!-- EXAMPLE 7: Model from External URL -->
      <!-- ========================================= -->
      <!-- Note: Make sure the URL supports CORS -->
      <a-entity
        gps-projected-entity-place="latitude: 9.4982; longitude: 76.3386;"
        gltf-model="url(https://cdn.glitch.com/324a5290-5aa7-4efc-92d6-ae0736433b12%2Fdragon.glb)"
        scale="5 5 5"
        rotation="0 0 0">
      </a-entity>

    </a-scene>

    <!-- Info Panel -->
    <div class="info-panel">
      <h3 style="margin: 0 0 10px 0;">ðŸŽ¯ Location AR - 3D Models</h3>
      <div id="location-info">
        <strong>Your Location:</strong><br>
        <span id="user-coords" style="font-size: 11px;">Waiting for GPS...</span>
      </div>
      <div class="model-info">
        <strong>Models Loaded:</strong><br>
        â€¢ Model 1: <span id="model1-status">Loading...</span><br>
        â€¢ Model 2: <span id="model2-status">Loading...</span><br>
        â€¢ Model 3: <span id="model3-status">Loading...</span>
      </div>
      <div style="margin-top: 10px; font-size: 11px; opacity: 0.7;">
        ðŸ’¡ Tip: Walk closer to see models appear
      </div>
    </div>

    <!-- Status -->
    <div class="status" id="status"></div>

    <!-- Controls -->
    <div class="controls">
      <button class="btn" onclick="refreshLocation()">ðŸ”„ Refresh GPS</button>
    </div>

    <script>
      // ===== CONFIGURATION =====
      let userLat = null;
      let userLng = null;
      let modelsLoaded = 0;
      const totalModels = 3;

      // ===== GPS FUNCTIONS =====
      
      function updateUserLocation(position) {
        userLat = position.coords.latitude;
        userLng = position.coords.longitude;
        
        document.getElementById('user-coords').innerHTML = 
          `${userLat.toFixed(6)}, ${userLng.toFixed(6)}<br>` +
          `Accuracy: ${position.coords.accuracy.toFixed(1)}m`;
        
        console.log('Location:', { userLat, userLng });
      }

      function refreshLocation() {
        showStatus('Refreshing location...', 2000);
        navigator.geolocation.getCurrentPosition(
          updateUserLocation,
          (error) => {
            console.error('GPS Error:', error);
            showStatus('GPS Error - Check permissions', 3000);
          },
          {
            enableHighAccuracy: true,
            timeout: 10000,
            maximumAge: 0
          }
        );
      }

      function showStatus(message, duration = 2000) {
        const status = document.getElementById('status');
        status.textContent = message;
        status.style.display = 'block';
        setTimeout(() => {
          status.style.display = 'none';
        }, duration);
      }

      // ===== MODEL LOADING =====
      
      function trackModelLoading() {
        const assets = document.querySelector('a-assets');
        const models = assets.querySelectorAll('a-asset-item');
        
        models.forEach((model, index) => {
          model.addEventListener('loaded', () => {
            modelsLoaded++;
            const statusId = `model${index + 1}-status`;
            const statusEl = document.getElementById(statusId);
            if (statusEl) {
              statusEl.textContent = 'âœ“ Ready';
              statusEl.style.color = '#4CAF50';
            }
            
            console.log(`Model ${index + 1} loaded`);
            
            // Update loading screen
            document.getElementById('loading-text').textContent = 
              `Loading models... ${modelsLoaded}/${totalModels}`;
            
            // Hide loading when all models are loaded
            if (modelsLoaded === totalModels) {
              setTimeout(() => {
                document.getElementById('loading').classList.add('hidden');
                showStatus('All models loaded! ðŸŽ‰', 3000);
              }, 500);
            }
          });
          
          model.addEventListener('error', (e) => {
            console.error(`Model ${index + 1} failed to load:`, e);
            const statusId = `model${index + 1}-status`;
            const statusEl = document.getElementById(statusId);
            if (statusEl) {
              statusEl.textContent = 'âœ— Failed';
              statusEl.style.color = '#f44336';
            }
          });
        });
      }

      // ===== CLICK HANDLER =====
      
      AFRAME.registerComponent('click-handler', {
        init: function() {
          this.el.addEventListener('click', () => {
            console.log('Model clicked!');
            showStatus('Model clicked! ðŸ‘†', 2000);
            
            // You can add any interaction here
            // Example: Play animation, show info, change color, etc.
          });
        }
      });

      // ===== ROTATION READER =====
      
      AFRAME.registerComponent('rotation-reader', {
        tick: function() {
          // Can be used for debugging orientation
        }
      });

      // ===== INITIALIZATION =====
      
      window.addEventListener('load', () => {
        const scene = document.querySelector('a-scene');
        
        // Track model loading
        trackModelLoading();
        
        // Scene loaded
        scene.addEventListener('loaded', () => {
          console.log('Scene loaded');
        });
        
        // Start GPS tracking
        if (navigator.geolocation) {
          // Watch position continuously
          navigator.geolocation.watchPosition(
            updateUserLocation,
            (error) => console.error('Watch position error:', error),
            {
              enableHighAccuracy: true,
              maximumAge: 0,
              timeout: 27000
            }
          );
          
          // Initial fetch
          refreshLocation();
        } else {
          alert('Geolocation not supported by your browser');
        }
      });

      // ===== HELPER: Calculate distance =====
      
      function calculateDistance(lat1, lon1, lat2, lon2) {
        const R = 6371000; // Earth's radius in meters
        const Ï†1 = lat1 * Math.PI / 180;
        const Ï†2 = lat2 * Math.PI / 180;
        const Î”Ï† = (lat2 - lat1) * Math.PI / 180;
        const Î”Î» = (lon2 - lon1) * Math.PI / 180;

        const a = Math.sin(Î”Ï† / 2) * Math.sin(Î”Ï† / 2) +
                  Math.cos(Ï†1) * Math.cos(Ï†2) *
                  Math.sin(Î”Î» / 2) * Math.sin(Î”Î» / 2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));

        return R * c;
      }

      // ===== UPDATE DISTANCES (Example) =====
      
      setInterval(() => {
        if (userLat && userLng) {
          // Example: Update distance to model at 9.4978, 76.3385
          const distance = calculateDistance(userLat, userLng, 9.4978, 76.3385);
          const label = document.getElementById('distance-label-1');
          if (label) {
            label.setAttribute('value', `${distance.toFixed(0)}m away`);
          }
        }
      }, 3000);
    </script>
  </body>
</html>
